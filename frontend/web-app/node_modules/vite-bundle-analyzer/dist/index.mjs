let e;import t from"path";import r from"os";import n from"child_process";import i from"zlib";import o from"util";import s from"fs";import l from"http";import u from"net";import a from"url";import c from"path";import d from"module";let f=a.fileURLToPath(import.meta.url),p=c.dirname(f);d.createRequire(import.meta.url);var h,m={exports:{}};Object.defineProperty(m.exports,"__esModule",{value:!0});let{round:g,floor:y,max:w}=Math,S=e=>{let[,t]=/([a-f\d]{3,6})/i.exec(e)||[],r=t?t.length:0;if(3===r)t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];else if(6!==r)return[0,0,0];let n=parseInt(t,16);return[n>>16&255,n>>8&255,255&n]},x=(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:g((e-8)/247*24)+232:16+36*g(e/51)+6*g(t/51)+g(r/51),b=e=>{let t,r,n,i,o,s;return e<8?30+e:e<16?e-8+90:(e>=232?t=r=n=(10*(e-232)+8)/255:(s=(e-=16)%36,t=y(e/36)/5,r=y(s/6)/5,n=s%6/5),0==(i=2*w(t,r,n))?30:(o=30+(g(n)<<2|g(r)<<1|g(t)),2===i?o+60:o))},z=(e,t,r)=>b(x(e,t,r)),_=(e=>{let t=e=>!!u.find(t=>e.test(t)),r=globalThis,n=r.Deno,i=null!=n,o=r.process||n||{},s=o.stdout,l="win32"===(i?n.build.os:o.platform),u=o.argv||o.args||[],a=o.env||{},c=-1;if(i)try{a=a.toObject()}catch(e){c=0}let d="FORCE_COLOR",f=a[d],p=parseInt(f),h="false"===f?0:isNaN(p)?3:p,m="NO_COLOR"in a||0===h||t(/^-{1,2}(no-color|color=(false|never))$/),g=d in a&&h||t(/^-{1,2}color=?(true|always)?$/),y=(a.NEXT_RUNTIME||"").indexOf("edge")>-1||"PM2_HOME"in a&&"pm_id"in a||(i?n.isatty(1):s&&"isTTY"in s);return m?0:(c<0&&(c=((e,t,r)=>{let{TERM:n,COLORTERM:i}=e;return"TF_BUILD"in e?1:"TEAMCITY_VERSION"in e?2:"CI"in e?["GITHUB_ACTIONS","GITEA_ACTIONS"].some(t=>t in e)?3:1:!t||/-mono|dumb/i.test(n)?0:r||"truecolor"===i||"24bit"===i||"xterm-kitty"===n?3:/-256(colou?r)?$/i.test(n)?2:/^screen|^tmux|^xterm|^vt[1-5][0-9]([0-9])?|^ansi|color|cygwin|linux|mintty|rxvt/i.test(n)?1:3})(a,y,l)),g&&0===c?3:c)})(),O=_>0,v={open:"",close:""},k=O?(e,t)=>({open:`[${e}m`,close:`[${t}m`}):()=>v,$=e=>(t,r,n)=>e(x(t,r,n)),M=e=>t=>{let[r,n,i]=S(t);return e(r,n,i)},C=e=>k(`38;5;${e}`,39),j=e=>k(`48;5;${e}`,49),E=(e,t,r)=>k(`38;2;${e};${t};${r}`,39),I=(e,t,r)=>k(`48;2;${e};${t};${r}`,49);1===_?(C=e=>k(b(e),39),j=e=>k(b(e)+10,49),E=(e,t,r)=>k(z(e,t,r),39),I=(e,t,r)=>k(z(e,t,r)+10,49)):2===_&&(E=$(C),I=$(j));let N,P,T={ansi256:C,bgAnsi256:j,fg:C,bg:j,rgb:E,bgRgb:I,hex:M(E),bgHex:M(I),visible:v,reset:k(0,0),inverse:k(7,27),hidden:k(8,28),bold:k(1,22),dim:k(2,22),italic:k(3,23),underline:k(4,24),strikethrough:k(9,29),strike:k(9,29),grey:k(90,39),gray:k(90,39),bgGrey:k(100,49),bgGray:k(100,49)},B="Bright",R=30;for(N of["black","red","green","yellow","blue","magenta","cyan","white"])P="bg"+N[0].toUpperCase()+N.slice(1),T[N]=k(R,39),T[N+B]=k(R+60,39),T[P]=k(R+10,49),T[P+B]=k(R+70,49),R++;let{defineProperty:A,defineProperties:L,setPrototypeOf:F}=Object,D=/[Â›][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,U=/(\r?\n)/g,W={},G=({_p:t},{open:r,close:n})=>{let i=(e,...t)=>{if(!e)return"";let r=i._p,{_a:n,_b:o}=r,s=null!=e.raw?String.raw(e,...t):""+e;if(s.includes("\x1b"))for(;null!=r;){let e=r.close,t=e.length;if(t){let n,i=0,o="";for(;~(n=s.indexOf(e,i));)o+=s.slice(i,n)+r.open,i=n+t;i&&(s=o+s.slice(i))}r=r._p}return s.includes("\n")&&(s=s.replace(U,o+"$1"+n)),n+s+o},o=r,s=n;return null!=t&&(o=t._a+r,s=n+t._b),F(i,e),i._p={open:r,close:n,_a:o,_b:s,_p:t},i.open=o,i.close=s,i},q=function(){let t=e=>""+e;return t.isSupported=()=>O,t.strip=e=>e.replace(D,""),t.extend=r=>{for(let e in r){let t=r[e],n=typeof t,i="string"===n?E(...S(t)):t;W[e]="function"===n?{get(){return(...e)=>G(this,t(...e))}}:{get(){let t=G(this,i);return A(this,e,{value:t}),t}}}F(t,e=L({},W))},t.extend(T),t},J=new q;m.exports=J,m.exports.Ansis=q;var H=(h=m.exports)&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h;let K=s.promises,Y=new TextEncoder,Z=o.promisify(i.gzip),V={level:i.constants.Z_DEFAULT_LEVEL},X=ee(t.join(p,"client")),Q=ee(t.join(X,"assets"));function ee(e){return/^\\\\\?\\/.test(e)?e:e.replace(/\\/g,"/")}function et(e){return"string"==typeof e?Y.encode(e):e}async function er(e){let r=await Promise.all((await K.readdir(e)).map(r=>t.join(e,r))),n=0,i=[];for(;n!==r.length;){let e=r[n],o=await K.stat(e);if(o.isDirectory()){let n=await K.readdir(e);r.push(...n.map(r=>t.join(e,r)))}o.isFile()&&i.push(e),n++}return i}let en=process.env.DEBUG||process.env.ANALYZE_DEBUG?(...e)=>{console.log(H.hex("#5B45DE")("[vite:bundle-analyzer]"),...e)}:()=>{};function ei(e){let t="head"===e.injectTo?/([ \t]*)<\/head>/i:/([ \t]*)<\/body>/i;e.descriptors=Array.isArray(e.descriptors)?e.descriptors:[e.descriptors];let r=e.descriptors.map(e=>e.attrs&&e.attrs.length>0?`<${e.kind} ${e.attrs.join(" ")}>${e.text}</${e.kind}>`:`<${e.kind}>${e.text}</${e.kind}>`);return e.html.replace(t,e=>`${r.join("\n")}${e}`)}function eo(e,t){let{stringify:r}=JSON;return`var defaultSizes=${r(t)},analyzeModule=${r(e)};`}async function es(e,r){let n=await er(Q),i=(await Promise.all(n.map(async e=>({fileType:t.extname(e).replace(".",""),content:await K.readFile(e,"utf8")})))).filter(e=>["js","css"].includes(e.fileType)),o=await K.readFile(t.join(X,"index.html"),"utf8");return o=ei({html:o=(o=(o=o.replace(/<script\b[^>]*>[\s\S]*?<\/script>/gi,"")).replace(/<link\b[^>]*rel="stylesheet"[^>]*>/gi,"")).replace(/<title>(.*?)<\/title>/,`<title>${r.title}</title>`),injectTo:"head",descriptors:i.map(({fileType:e,content:t})=>({kind:"js"===e?"script":"style",text:t,attrs:"js"===e?['type="module"']:[]}))}),o=ei({html:o,injectTo:"body",descriptors:{kind:"script",text:eo(e,r.mode)}})}let el=["pnpm-workspace.yaml","lerna.json"];function eu(e,r=function e(r,n=r){if(function(e){let r=t.join(e,"package.json");return s.existsSync(r)}(r))return r;let i=t.dirname(r);return i&&i!==r?e(i,n):n}(e)){if(el.some(r=>s.existsSync(t.join(e,r)))||function(e){let r=t.join(e,"package.json");if(!function(e){if(!function(e){try{return s.statSync(e,{throwIfNoEntry:!1})}catch{}}(e))return!1;try{return s.accessSync(e,s.constants.R_OK),!0}catch{return!1}}(r))return!1;try{return!!(JSON.parse(s.readFileSync(r,"utf-8"))||{}).workspaces}catch{return!1}}(e))return e;let n=t.dirname(e);return n&&n!==e?eu(n,r):r}class ea{kind;meta;filename;children;groups;isEndOfPath;constructor(e){this.kind=e?.kind||"stat",this.meta=e?.meta||{},this.filename=e?.filename||"",this.children=new Map,this.groups=[],this.isEndOfPath=!1}}class ec{root;constructor(e){this.root=new ea(e)}insert(e,t){let r=this.root,n=e.split("/").filter(Boolean),i="";for(let e of n)i=i?`${i}/${e}`:e,r.children.has(e)||r.children.set(e,new ea({...t})),(r=r.children.get(e)).filename=i;r.isEndOfPath=!0}mergePrefixSingleDirectory(e=this.root){for(let[t,r]of e.children.entries()){if(r.isEndOfPath)break;if(r.children.size>1){this.mergePrefixSingleDirectory(r);continue}for(let[n,i]of(e.children.delete(t),r.children.entries()))e.children.set(`${t}/${n}`,i),i.isEndOfPath||this.mergePrefixSingleDirectory(i)}}walk(e,t){if(e.children.size){for(let[r,n]of e.children.entries()){let i={...n.meta,label:r,groups:n.groups,filename:n.filename};if(n.isEndOfPath&&delete i.groups,t(i,e),this.walk(n,t),i.groups&&i.groups.length)switch(e.kind){case"stat":i.statSize=i.groups.reduce((e,t)=>e+t.statSize,0);break;case"source":{let e=i.groups.reduce((e,t)=>(e.parsedSize+=t.parsedSize,e.gzipSize+=t.gzipSize,e),{parsedSize:0,gzipSize:0});Object.assign(i,e)}}}e.children.clear()}}}let ed="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ef=new Uint8Array(64),ep=new Uint8Array(128);for(let e=0;e<ed.length;e++){let t=ed.charCodeAt(e);ef[e]=t,ep[t]=e}let eh="undefined"!=typeof TextDecoder?new TextDecoder:"undefined"!=typeof Buffer?{decode:e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString()}:{decode(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}};function em(e,t,r,n){let i=0,o=0,s=0;do i|=(31&(s=ep[e.charCodeAt(t++)]))<<o,o+=5;while(32&s);let l=1&i;return i>>>=1,l&&(i=-2147483648|-i),r[n]+=i,t}function eg(e,t,r){return!(t>=r)&&44!==e.charCodeAt(t)}function ey(e,t){return e[0]-t[0]}function ew(e,t,r,n,i){let o=n[i],s=o-r[i];r[i]=o,s=s<0?-s<<1|1:s<<1;do{let r=31&s;(s>>>=5)>0&&(r|=32),e[t++]=ef[r]}while(s>0);return t}let eS=/^[\w+.-]+:\/\//,ex=/^([\w+.-]+:)\/\/([^@/#?]*@)?([^:/#?]*)(:\d+)?(\/[^#?]*)?(\?[^#]*)?(#.*)?/,eb=/^file:(?:\/\/((?![a-z]:)[^/#?]*)?)?(\/?[^#?]*)(\?[^#]*)?(#.*)?/i;function ez(e){return e.startsWith("/")}function e_(e){return/^[.?#]/.test(e)}function eO(e){let t=ex.exec(e);return ev(t[1],t[2]||"",t[3],t[4]||"",t[5]||"/",t[6]||"",t[7]||"")}function ev(e,t,r,n,i,o,s){return{scheme:e,user:t,host:r,port:n,path:i,query:o,hash:s,type:7}}function ek(e){if(e.startsWith("//")){let t=eO("http:"+e);return t.scheme="",t.type=6,t}if(ez(e)){let t=eO("http://foo.com"+e);return t.scheme="",t.host="",t.type=5,t}if(e.startsWith("file:"))return function(e){let t=eb.exec(e),r=t[2];return ev("file:","",t[1]||"","",ez(r)?r:"/"+r,t[3]||"",t[4]||"")}(e);if(eS.test(e))return eO(e);let t=eO("http://foo.com/"+e);return t.scheme="",t.host="",t.type=e?e.startsWith("?")?3:e.startsWith("#")?2:4:1,t}function e$(e,t){let r=t<=4,n=e.path.split("/"),i=1,o=0,s=!1;for(let e=1;e<n.length;e++){let t=n[e];if(!t){s=!0;continue}if(s=!1,"."!==t){if(".."===t){o?(s=!0,o--,i--):r&&(n[i++]=t);continue}n[i++]=t,o++}}let l="";for(let e=1;e<i;e++)l+="/"+n[e];l&&(!s||l.endsWith("/.."))||(l+="/"),e.path=l}function eM(e,t){return t&&!t.endsWith("/")&&(t+="/"),function(e,t){if(!e&&!t)return"";let r=ek(e),n=r.type;if(t&&7!==n){let e=ek(t),i=e.type;switch(n){case 1:r.hash=e.hash;case 2:r.query=e.query;case 3:case 4:e$(e,e.type),"/"===r.path?r.path=e.path:r.path=function(e){if(e.endsWith("/.."))return e;let t=e.lastIndexOf("/");return e.slice(0,t+1)}(e.path)+r.path;case 5:r.user=e.user,r.host=e.host,r.port=e.port;case 6:r.scheme=e.scheme}i>n&&(n=i)}e$(r,n);let i=r.query+r.hash;switch(n){case 2:case 3:return i;case 4:{let n=r.path.slice(1);if(!n)return i||".";if(e_(t||e)&&!e_(n))return"./"+n+i;return n+i}case 5:return r.path+i;default:return r.scheme+"//"+r.user+r.host+r.port+r.path+i}}(e,t)}function eC(e,t){for(let r=t;r<e.length;r++)if(!function(e){for(let t=1;t<e.length;t++)if(e[t][0]<e[t-1][0])return!1;return!0}(e[r]))return r;return e.length}function ej(e,t){return e[0]-t[0]}let eE=!1;function eI(e,t,r){for(let n=r+1;n<e.length&&e[n][0]===t;r=n++);return r}function eN(e,t,r){for(let n=r-1;n>=0&&e[n][0]===t;r=n--);return r}function eP(){return{lastKey:-1,lastNeedle:-1,lastIndex:-1}}function eT(e,t,r,n){let{lastKey:i,lastNeedle:o,lastIndex:s}=r,l=0,u=e.length-1;if(n===i){if(t===o)return eE=-1!==s&&e[s][0]===t,s;t>=o?l=-1===s?0:s:u=s}return r.lastKey=n,r.lastNeedle=t,r.lastIndex=function(e,t,r,n){for(;r<=n;){let i=r+(n-r>>1),o=e[i][0]-t;if(0===o)return eE=!0,i;o<0?r=i+1:n=i-1}return eE=!1,r-1}(e,t,l,u)}function eB(){return{__proto__:null}}let eR=function(e,t){let r=eA(e);if(!("sections"in r))return new eU(r,t);let n=[],i=[],o=[],s=[],l=[];return function e(t,r,n,i,o,s,l,u,a,c,d){let{sections:f}=t;for(let t=0;t<f.length;t++){let{map:p,offset:h}=f[t],m=c,g=d;if(t+1<f.length){let e=f[t+1].offset;(m=Math.min(c,u+e.line))===c?g=Math.min(d,a+e.column):m<c&&(g=a+e.column)}!function(t,r,n,i,o,s,l,u,a,c,d){let f=eA(t);if("sections"in f)return e(...arguments);let p=new eU(f,r),h=i.length,m=s.length,g=eW(p),{resolvedSources:y,sourcesContent:w,ignoreList:S}=p;if(eL(i,y),eL(s,p.names),w)eL(o,w);else for(let e=0;e<y.length;e++)o.push(null);if(S)for(let e=0;e<S.length;e++)l.push(S[e]+h);for(let e=0;e<g.length;e++){let t=u+e;if(t>c)return;let r=function(e,t){for(let r=e.length;r<=t;r++)e[r]=[];return e[t]}(n,t),i=0===e?a:0,o=g[e];for(let e=0;e<o.length;e++){let n=o[e],s=i+n[0];if(t===c&&s>=d)return;if(1===n.length){r.push([s]);continue}let l=h+n[1],u=n[2],a=n[3];r.push(4===n.length?[s,l,u,a]:[s,l,u,a,m+n[4]])}}}(p,r,n,i,o,s,l,u+h.line,a+h.column,m,g)}}(r,t,n,i,o,s,l,0,0,1/0,1/0),function(e,t){var r;let n=new eU((r=[],{version:e.version,file:e.file,names:e.names,sourceRoot:e.sourceRoot,sources:e.sources,sourcesContent:e.sourcesContent,mappings:r,ignoreList:e.ignoreList||e.x_google_ignoreList}),void 0);return n._decoded=e.mappings,n}({version:3,file:r.file,names:s,sources:i,sourcesContent:o,mappings:n,ignoreList:l})};function eA(e){return"string"==typeof e?JSON.parse(e):e}function eL(e,t){for(let r=0;r<t.length;r++)e.push(t[r])}let eF="`line` must be greater than 0 (lines start at line 1)",eD="`column` must be greater than or equal to 0 (columns start at column 0)";class eU{constructor(e,t){let r="string"==typeof e;if(!r&&e._decodedMemo)return e;let n=r?JSON.parse(e):e,{version:i,file:o,names:s,sourceRoot:l,sources:u,sourcesContent:a}=n;this.version=i,this.file=o,this.names=s||[],this.sourceRoot=l,this.sources=u,this.sourcesContent=a,this.ignoreList=n.ignoreList||n.x_google_ignoreList||void 0;let c=eM(l||"",function(e){if(!e)return"";let t=e.lastIndexOf("/");return e.slice(0,t+1)}(t));this.resolvedSources=u.map(e=>eM(e||"",c));let{mappings:d}=n;"string"==typeof d?(this._encoded=d,this._decoded=void 0):(this._encoded=void 0,this._decoded=function(e,t){let r=eC(e,0);if(r===e.length)return e;t||(e=e.slice());for(let i=r;i<e.length;i=eC(e,i+1)){var n;e[i]=(n=e[i],t||(n=n.slice()),n.sort(ej))}return e}(d,r)),this._decodedMemo=eP(),this._bySources=void 0,this._bySourceMemos=void 0}}function eW(e){return e._decoded||(e._decoded=function(e){let t=new Int32Array(5),r=[],n=0;do{let i=function(e,t){let r=e.indexOf(";",t);return -1===r?e.length:r}(e,n),o=[],s=!0,l=0;t[0]=0;for(let r=n;r<i;r++){let n;r=em(e,r,t,0);let u=t[0];u<l&&(s=!1),l=u,eg(e,r,i)?(r=em(e,r,t,1),r=em(e,r,t,2),r=em(e,r,t,3),eg(e,r,i)?(r=em(e,r,t,4),n=[u,t[1],t[2],t[3],t[4]]):n=[u,t[1],t[2],t[3]]):n=[u],o.push(n)}s||function(e){e.sort(ey)}(o),r.push(o),n=i+1}while(n<=e.length);return r}(e._encoded))}function eG(e,t,r,n){return{source:e,line:t,column:r,name:n}}function eq(e,t){return{line:e,column:t}}function eJ(e,t,r,n,i){let o=eT(e,n,t,r);return(eE?o=(-1===i?eI:eN)(e,n,o):-1===i&&o++,-1===o||o===e.length)?-1:o}function eH(e,t,r,n,i,o){if(--r<0)throw Error(eF);if(n<0)throw Error(eD);let{sources:s,resolvedSources:l}=e,u=s.indexOf(t);if(-1===u&&(u=l.indexOf(t)),-1===u)return o?[]:eq(null,null);let a=(e._bySources||(e._bySources=function(e,t){let r=t.map(eB);for(let n=0;n<e.length;n++){let i=e[n];for(let e=0;e<i.length;e++){let o=i[e];if(1===o.length)continue;let s=o[1],l=o[2],u=o[3],a=r[s],c=a[l]||(a[l]=[]),d=t[s],f=eI(c,u,eT(c,u,d,l));d.lastIndex=++f,function(e,t,r){for(let r=e.length;r>t;r--)e[r]=e[r-1];e[t]=r}(c,f,[u,n,o[0]])}}return r}(eW(e),e._bySourceMemos=s.map(eP))))[u][r];if(null==a)return o?[]:eq(null,null);let c=e._bySourceMemos[u];if(o)return function(e,t,r,n,i){let o=eJ(e,t,r,n,1);if(!eE&&-1===i&&o++,-1===o||o===e.length)return[];let s=eE?n:e[o][0];eE||(o=eN(e,s,o));let l=eI(e,s,o),u=[];for(;o<=l;o++){let t=e[o];u.push(eq(t[1]+1,t[2]))}return u}(a,c,r,n,i);let d=eJ(a,c,r,n,i);if(-1===d)return eq(null,null);let f=a[d];return eq(f[1]+1,f[2])}class eK{constructor(e,t){let r=this._map=new eR(e,t);this.file=r.file,this.names=r.names,this.sourceRoot=r.sourceRoot,this.sources=r.resolvedSources,this.sourcesContent=r.sourcesContent,this.version=r.version}static fromSourceMap(e,t){return e.toDecodedMap?new eK(e.toDecodedMap(),t):new eK(e.toJSON(),t)}get mappings(){var e,t;return null!==(t=(e=this._map)._encoded)&&void 0!==t?t:e._encoded=function(e){let t=new Int32Array(5),r=new Uint8Array(16384),n=r.subarray(0,16348),i=0,o="";for(let s=0;s<e.length;s++){let l=e[s];if(s>0&&(16384===i&&(o+=eh.decode(r),i=0),r[i++]=59),0!==l.length){t[0]=0;for(let e=0;e<l.length;e++){let s=l[e];i>16348&&(o+=eh.decode(n),r.copyWithin(0,16348,i),i-=16348),e>0&&(r[i++]=44),i=ew(r,i,t,s,0),1!==s.length&&(i=ew(r,i,t,s,1),i=ew(r,i,t,s,2),i=ew(r,i,t,s,3),4!==s.length&&(i=ew(r,i,t,s,4)))}}}return o+eh.decode(r.subarray(0,i))}(e._decoded)}originalPositionFor(e){return function(e,t){let{line:r,column:n,bias:i}=t;if(--r<0)throw Error(eF);if(n<0)throw Error(eD);let o=eW(e);if(r>=o.length)return eG(null,null,null,null);let s=o[r],l=eJ(s,e._decodedMemo,r,n,i||1);if(-1===l)return eG(null,null,null,null);let u=s[l];if(1===u.length)return eG(null,null,null,null);let{names:a,resolvedSources:c}=e;return eG(c[u[1]],u[2]+1,u[3],5===u.length?a[u[4]]:null)}(this._map,e)}generatedPositionFor(e){return function(e,t){let{source:r,line:n,column:i,bias:o}=t;return eH(e,r,n,i,o||1,!1)}(this._map,e)}allGeneratedPositionsFor(e){return function(e,t){let{source:r,line:n,column:i,bias:o}=t;return eH(e,r,n,i,o||-1,!0)}(this._map,e)}hasContentsOfAllSources(){if(!this.sourcesContent||this.sourcesContent.length!==this.sources.length)return!1;for(let e of this.sourcesContent)if(null==e)return!1;return!0}sourceContentFor(e,t){let r=function(e,t){let{sourcesContent:r}=e;if(null==r)return null;let n=function(e,t){let{sources:r,resolvedSources:n}=e,i=r.indexOf(t);return -1===i&&(i=n.indexOf(t)),i}(e,t);return -1===n?null:r[n]}(this._map,e);if(null!=r)return r;if(t)return null;throw Error(`"${e}" is not in the SourceMap.`)}eachMapping(e,t){!function(e,t){let r=eW(e),{names:n,resolvedSources:i}=e;for(let e=0;e<r.length;e++){let o=r[e];for(let r=0;r<o.length;r++){let s=o[r],l=e+1,u=s[0],a=null,c=null,d=null,f=null;1!==s.length&&(a=i[s[1]],c=s[2]+1,d=s[3]),5===s.length&&(f=n[s[4]]),t({generatedLine:l,generatedColumn:u,source:a,originalLine:c,originalColumn:d,name:f})}}}(this._map,t?e.bind(t):e)}destroy(){}}class eY extends eK{constructor(e){super(JSON.parse(e),"")}}let eZ=new TextDecoder,eV=[".mjs",".js",".cjs",".ts",".tsx",".vue",".svelte",".md",".mdx"],eX=process.cwd();function eQ(e,r=eX){let n=function(e,t=eX){return(e=ee(e)).replace(t,"").replace(/\0/,"")}(e,r);return t.isAbsolute(n)?n.replace("/",""):n}class e0{originalId;filename;label;parsedSize;mapSize;statSize;gzipSize;source;stats;imports;isAsset;isEntry;constructor(e){this.originalId=e,this.filename=e,this.label=e,this.parsedSize=0,this.statSize=0,this.gzipSize=0,this.mapSize=0,this.source=[],this.stats=[],this.imports=new Set,this.isAsset=!0,this.isEntry=!1}addImports(...e){e.forEach(e=>this.imports.add(e))}async setup(e,r,n,i){let{imports:o,dynamicImports:s,map:l,moduleIds:u}=e;this.addImports(...o,...s),this.mapSize=l.length,this.isEntry=e.isEntry;let a=u.length?u.reduce((e,n)=>{let i=r.getModuleInfo(n);return i&&i.code&&(eV.includes(t.extname(i.id))||i.id.startsWith("\0"))&&e.push({id:i.id,code:i.code}),e},[]):function(e){let t=new eY(e),r=t.sources.reduce((e,r)=>{if(r){let n=t.sourceContentFor(r,!0);n&&e.push({id:r,code:n})}return e},[]);return t.destroy(),r}(l),c=new ec({meta:{statSize:0}}),d=new ec({kind:"source",meta:{gzipSize:0,parsedSize:0}});for(let e of a){if("."===e.id[0]){let t=await r.resolve(e.id,this.originalId);if(!t)continue;e.id=t.id}let t=et(e.code).byteLength;this.statSize+=t,c.insert(eQ(e.id,i),{kind:"stat",meta:{statSize:t}})}en("Start analyze stats: module '"+this.originalId+"' find "+a.length+" modules");let f=function(e,t,r){let n=new eY(t),i={},o=1,s=0,l=eZ.decode(e);for(let e=0;e<l.length;e++,s++){let{source:t}=n.originalPositionFor({line:o,column:s});if(null!=t){let n=r(t),o=l[e];n in i||(i[n]=""),i[n]+=o}"\n"===l[e]&&(o+=1,s=-1)}return n.destroy(),i}(e.code,l,e=>{let r=t.relative(i,e);return t.join(i,r)}),p=0;for(let e in f){if(!eV.includes(t.extname(e)))continue;let r=et(f[e]),{byteLength:o}=await n(r),s=r.byteLength;d.insert(eQ(e,i),{kind:"source",meta:{gzipSize:o,parsedSize:s}}),p++}for(let e of(en("Start analyze source: module '"+this.originalId+"' find "+p+" chunks"),c.mergePrefixSingleDirectory(),c.walk(c.root,(e,t)=>t.groups.push(e)),d.mergePrefixSingleDirectory(),d.walk(d.root,(e,t)=>t.groups.push(e)),this.stats=c.root.groups,this.source=d.root.groups,this.source))this.gzipSize+=e.gzipSize,this.parsedSize+=e.parsedSize}}class e1{compress;modules;workspaceRoot;pluginContext;chunks;constructor(e){this.compress=function(e={}){return e=Object.assign(V,e),t=>Z(t,e)}(e),this.modules=[],this.pluginContext=null,this.chunks={},this.workspaceRoot=process.cwd()}installPluginContext(e){this.pluginContext||(this.pluginContext=e)}setupRollupChunks(e){this.chunks=e}async addModule(e,t){let r=function(e,t,r){let n={},i="chunk"===e.type;return n.code=et(i?e.code:e.source),n.map=function(e,t,r){if(t in r)return r[t].source;throw Error(`[analyzer error]: Missing sourcemap for ${e}.`)}(e.fileName,r,t),n.imports=i?e.imports:[],n.dynamicImports=i?e.dynamicImports:[],n.moduleIds=i?e.moduleIds:[],n.filename=e.fileName,n.isEntry=!!i&&e.isEntry,n}(e,this.chunks,t),n=new e0(r.filename);await n.setup(r,this.pluginContext,this.compress,this.workspaceRoot),this.modules.push(n)}processModule(){return this.modules.map(e=>{let{originalId:t,imports:r,...n}=e;return{...n,imports:[...r]}})}}let e2={".js":"application/javascript",".css":"text/css"};async function e3(e){let t=()=>Math.floor(64512*Math.random())+1024,r=async e=>new Promise(t=>{let r=u.createServer();r.once("error",e=>{"EADDRINUSE"===e.code?t(!1):t(!0)}),r.once("listening",()=>{r.close(()=>{t(!0)})}),r.listen(e,"localhost")});if(0===e){let e=!1,n=0;for(;!e;)n=t(),e=await r(n);return n}let n=await r(e);if(n)return e;{let t=e+1;for(;;){if(n=await r(t))return t;t++}}}async function e4(e=0){let r=l.createServer(),n=await e3(e);return r.listen(n,()=>{console.log(`server run on http://localhost:${n}`)}),{setup:(e,n)=>{r.on("request",function(e,r){let n=new Map;return function(i,o){let l=t.join(X,i.url);if(n.has(l)){let{data:e,mimeType:t}=n.get(l);o.writeHead(200,{"Content-Type":t}),o.end(e);return}if("/"===i.url){o.setHeader("Content-Type","text/html; charset=utf8;");let i=s.readFileSync(t.join(X,"index.html"),"utf8");i=ei({html:i=i.replace(/<title>(.*?)<\/title>/,`<title>${e.title}</title>`),injectTo:"body",descriptors:{kind:"script",text:eo(r,e.mode)}}),o.end(i),n.set(l,{data:i,mimeType:"text/html; charset=utf8;"});return}s.readFile(l,(e,r)=>{if(e)o.statusCode=404,o.end("Not Found");else{let e=e2[t.extname(l)]||"application/octet-stream";o.writeHead(200,{"Content-Type":e}),o.end(r),n.set(l,{data:r,mimeType:e})}})}}(n,e))},get port(){return n}}}function e8(e){let t=["name","generateBundle","closeBundle","api"].reduce((t,r)=>(t[r]=e[r],t),{}),r=process.cwd(),{store:n}=t.api;return{...t,outputOptions(e){if(!n.hasSetSourcemapOption)return e.dir&&(r=e.dir),n.analyzerModule.workspaceRoot=eu(r),"sourcemap"in e&&(n.previousSourcemapOption="boolean"==typeof e.sourcemap?e.sourcemap:"hidden"===e.sourcemap),"boolean"==typeof e.sourcemap&&e.sourcemap?e.sourcemap=!0:e.sourcemap="hidden",e}}}let e5=!!process.env.CI,e6={analyzerMode:"server",summary:!0},e9=e=>H.dim(H.bold(e+"")),e7=e=>e9(function(e){if(!e)return"0 Bytes";let t=parseInt(`${Math.floor(Math.log(e)/Math.log(1024))}`);return(e/(1<<10*t)).toFixed(2)+" "+["Bytes","KB","MB","GB","TB"][t]}(e)),te=e=>{let t=e.length,r=e.reduce((e,t)=>(e.gzip+=t.gzipSize,e.parsed+=t.parsedSize,e.map+=t.mapSize,e),{gzip:0,parsed:0,map:0}),n=[r.gzip&&`gzip: ${e7(r.gzip)}`,r.map&&`map: ${e7(r.map)}`].filter(Boolean).join(" | ");return`${e9(t)} chunks of ${e7(r.parsed)} ${n?`(${n})`:""}`};function tt(e){let i;let{reportTitle:o="vite-bundle-analyzer"}=e=e?{...e6,...e}:e6,s=new e1(e?.gzipOptions),l={previousSourcemapOption:!1,hasSetSourcemapOption:!1,analyzerModule:s},u=process.cwd(),a=!0,c=process.cwd();return{name:"vite-bundle-anlyzer",apply:"build",enforce:"post",api:{store:l},configResolved(r){if(u=t.resolve(r.root,r.build.outDir??""),i=r.logger,c=eu(r.root),s.workspaceRoot=c,e.summary){let e=r.plugins.find(e=>"vite:reporter"===e.name);if(a=!!e?.writeBundle,e?.writeBundle){let t="function"==typeof e.writeBundle?e.writeBundle:e.writeBundle?.handler,r=async function(...e){await t?.apply(this,e),i.info(te(s.modules))};"function"!=typeof e.writeBundle?e.writeBundle.handler=r:e.writeBundle=r}}l.hasSetSourcemapOption||(l.hasSetSourcemapOption=!0,r.build?.sourcemap&&(l.previousSourcemapOption="boolean"==typeof r.build.sourcemap?r.build.sourcemap:"hidden"===r.build.sourcemap),"boolean"==typeof r.build.sourcemap&&r.build.sourcemap?r.build.sourcemap=!0:r.build.sourcemap="hidden",en("Sourcemap option is set to '"+r.build.sourcemap+"'"))},async generateBundle(e,r){for(let e in s.installPluginContext(this),s.setupRollupChunks(r),r){let n=r[e],[i,o]=function(e,r){let{type:n}=e;if("asset"===n&&".js"===t.extname(e.fileName)){let t=e.fileName+".map";return t in r?[!0,t]:[!0,null]}let i="chunk"===n;return[i,i?e.sourcemapFileName:null]}(n,r),u=!!o;en("Processing chunk '"+n.fileName+"'.Chunk status: "+i+". Sourcemap status: "+u+"."),i&&o&&await s.addModule(n,o),!l.previousSourcemapOption&&i&&o&&Reflect.deleteProperty(r,o)}},async closeBundle(){switch(e.summary&&!a&&i.info(te(s.modules)),en("Finish analyze bundle."+s.modules.length+" chunks found."),e.analyzerMode){case"json":{let r=t.join(u,e.fileName?`${e.fileName}.json`:"stats.json"),n=s.processModule();return K.writeFile(r,JSON.stringify(n,null,2),"utf8")}case"static":{let r=t.join(u,e.fileName?`${e.fileName}.html`:"stats.html"),n=s.processModule(),i=await es(n,{title:o,mode:"stat"});return K.writeFile(r,i,"utf8")}case"server":{let t=s.processModule(),{setup:i,port:l}=await e4(("auto"===e.analyzerPort?0:e.analyzerPort)??8888);i(t,{title:o,mode:"stat"}),(e.openAnalyzer??!0)&&!e5&&function(e){let[t,i]=function(e){switch(e){case"linux":if(-1!==r.release().toLocaleLowerCase().indexOf("microsoft"))return["win32","cmd.exe"];return["linux","xdg-open"];case"win32":return["win32","cmd.exe"];case"darwin":return["darwin","open"];default:return[e,"xdg-open"]}}(r.platform());"win32"===t&&(e=["/c","start",'""'].concat(e=e.map(e=>e.replace(/[&^]/g,"^$&")))),n.spawn(i,e)}([`http://localhost:${l}`]);break}default:throw Error("Invalidate Option `analyzerMode`")}}}}export{e8 as adapter,tt as analyzer,tt as default};
